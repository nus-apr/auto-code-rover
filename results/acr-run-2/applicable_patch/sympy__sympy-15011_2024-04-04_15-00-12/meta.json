{
    "task_id": "sympy__sympy-15011",
    "setup_info": {
        "repo_path": "/home/haifeng/projects/reverse-prompt/SWE-bench/testbed/sympy__sympy/setup_sympy__sympy__1.2",
        "env_name": "setup_sympy__sympy__1.2",
        "pre_install": [],
        "install": "python -m pip install -e .",
        "test_cmd": "bin/test -C --verbose sympy/utilities/tests/test_lambdify.py"
    },
    "task_info": {
        "instance_id": "sympy__sympy-15011",
        "base_commit": "b7c5ba2bf3ffd5cf453b25af7c8ddd9a639800cb",
        "hints_text": "The default here should be to always dummify, unless dummify is explicitly False https://github.com/sympy/sympy/blob/a78cf1d3efe853f1c360f962c5582b1d3d29ded3/sympy/utilities/lambdify.py?utf8=%E2%9C%93#L742\nHi, I would like to work on this if possible",
        "created_at": "2018-08-02T12:54:02Z",
        "test_patch": "diff --git a/sympy/utilities/tests/test_lambdify.py b/sympy/utilities/tests/test_lambdify.py\n--- a/sympy/utilities/tests/test_lambdify.py\n+++ b/sympy/utilities/tests/test_lambdify.py\n@@ -728,6 +728,14 @@ def test_dummification():\n     raises(SyntaxError, lambda: lambdify(2 * F(t), 2 * F(t) + 5))\n     raises(SyntaxError, lambda: lambdify(2 * F(t), 4 * F(t) + 5))\n \n+def test_curly_matrix_symbol():\n+    # Issue #15009\n+    curlyv = sympy.MatrixSymbol(\"{v}\", 2, 1)\n+    lam = lambdify(curlyv, curlyv)\n+    assert lam(1)==1\n+    lam = lambdify(curlyv, curlyv, dummify=True)\n+    assert lam(1)==1\n+\n def test_python_keywords():\n     # Test for issue 7452. The automatic dummification should ensure use of\n     # Python reserved keywords as symbol names will create valid lambda\n",
        "repo": "sympy/sympy",
        "problem_statement": "lambdify does not work with certain MatrixSymbol names even with dummify=True\n`lambdify` is happy with curly braces in a symbol name and with `MatrixSymbol`s, but not with both at the same time, even if `dummify` is `True`.\r\n\r\nHere is some basic code that gives the error.\r\n```\r\nimport sympy as sy\r\ncurlyx = sy.symbols(\"{x}\")\r\nv = sy.MatrixSymbol(\"v\", 2, 1)\r\ncurlyv = sy.MatrixSymbol(\"{v}\", 2, 1)\r\n```\r\n\r\nThe following two lines of code work:\r\n```\r\ncurlyScalarId = sy.lambdify(curlyx, curlyx)\r\nvectorId = sy.lambdify(v,v)\r\n```\r\n\r\nThe following two lines of code give a `SyntaxError`:\r\n```\r\ncurlyVectorId = sy.lambdify(curlyv, curlyv)\r\ncurlyVectorIdDummified = sy.lambdify(curlyv, curlyv, dummify=True)\r\n```\r\n\r\n\n",
        "version": "1.2",
        "FAIL_TO_PASS": [
            "test_curly_matrix_symbol"
        ],
        "PASS_TO_PASS": [
            "test_ITE",
            "test_Min_Max",
            "test_atoms",
            "test_bad_args",
            "test_docs",
            "test_dummification",
            "test_exponentiation",
            "test_imps",
            "test_imps_errors",
            "test_imps_wrong_args",
            "test_integral",
            "test_issue9474",
            "test_issue_12092",
            "test_issue_12173",
            "test_issue_2790",
            "test_lambdify_docstring",
            "test_lambdify_dummy_arg",
            "test_lambdify_imps",
            "test_lambdify_inspect",
            "test_lambdify_mixed_symbol_dummy_args",
            "test_list_args",
            "test_math",
            "test_math_lambda",
            "test_math_transl",
            "test_matrix",
            "test_mpmath_lambda",
            "test_mpmath_precision",
            "test_mpmath_transl",
            "test_namespace_order",
            "test_namespace_type",
            "test_nested_args",
            "test_no_args",
            "test_number_precision",
            "test_own_module",
            "test_own_namespace_1",
            "test_own_namespace_2",
            "test_python_keywords",
            "test_sin",
            "test_sinc_mpmath",
            "test_single_arg",
            "test_special_printers",
            "test_sqrt",
            "test_str_args",
            "test_sym_integral",
            "test_sym_list_args",
            "test_sym_single_arg",
            "test_sympy_lambda",
            "test_trig",
            "test_trig_float",
            "test_trig_symbolic",
            "test_true_false",
            "test_vector_discontinuous",
            "test_vector_simple"
        ],
        "environment_setup_commit": "e53e809176de9aa0fb62e85689f8cdb669d4cacb",
        "patch": "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -700,14 +700,13 @@ def _is_safe_ident(cls, ident):\n             return isinstance(ident, str) and cls._safe_ident_re.match(ident) \\\n                 and not (keyword.iskeyword(ident) or ident == 'None')\n \n-\n     def _preprocess(self, args, expr):\n         \"\"\"Preprocess args, expr to replace arguments that do not map\n         to valid Python identifiers.\n \n         Returns string form of args, and updated expr.\n         \"\"\"\n-        from sympy import Dummy, Symbol, Function, flatten\n+        from sympy import Dummy, Symbol, MatrixSymbol, Function, flatten\n         from sympy.matrices import DeferredVector\n \n         dummify = self._dummify\n@@ -725,7 +724,7 @@ def _preprocess(self, args, expr):\n                 argstrs.append(nested_argstrs)\n             elif isinstance(arg, DeferredVector):\n                 argstrs.append(str(arg))\n-            elif isinstance(arg, Symbol):\n+            elif isinstance(arg, Symbol) or isinstance(arg, MatrixSymbol):\n                 argrep = self._argrepr(arg)\n \n                 if dummify or not self._is_safe_ident(argrep):\n@@ -739,7 +738,14 @@ def _preprocess(self, args, expr):\n                 argstrs.append(self._argrepr(dummy))\n                 expr = self._subexpr(expr, {arg: dummy})\n             else:\n-                argstrs.append(str(arg))\n+                argrep = self._argrepr(arg)\n+\n+                if dummify:\n+                    dummy = Dummy()\n+                    argstrs.append(self._argrepr(dummy))\n+                    expr = self._subexpr(expr, {arg: dummy})\n+                else:\n+                    argstrs.append(str(arg))\n \n         return argstrs, expr\n \n",
        "pr_link": "https://github.com/sympy/sympy/pull/15011"
    }
}