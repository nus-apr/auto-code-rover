{
    "task_id": "sympy__sympy-14817",
    "setup_info": {
        "repo_path": "/home/haifeng/projects/reverse-prompt/SWE-bench/testbed/sympy__sympy/setup_sympy__sympy__1.1",
        "env_name": "setup_sympy__sympy__1.1",
        "pre_install": [],
        "install": "python -m pip install -e .",
        "test_cmd": "bin/test -C --verbose sympy/printing/pretty/tests/test_pretty.py"
    },
    "task_info": {
        "instance_id": "sympy__sympy-14817",
        "base_commit": "0dbdc0ea83d339936da175f8c3a97d0d6bafb9f8",
        "hints_text": "Looks like it comes from fbbbd392e6c which is from https://github.com/sympy/sympy/pull/14248. CC @jashan498 \n`_print_MatAdd` should use the same methods as `_print_Add` to determine whether or not to include a plus or minus sign. If it's possible, it could even reuse the same code. ",
        "created_at": "2018-06-21T08:34:37Z",
        "test_patch": "diff --git a/sympy/printing/pretty/tests/test_pretty.py b/sympy/printing/pretty/tests/test_pretty.py\n--- a/sympy/printing/pretty/tests/test_pretty.py\n+++ b/sympy/printing/pretty/tests/test_pretty.py\n@@ -6094,11 +6094,16 @@ def test_MatrixSymbol_printing():\n     A = MatrixSymbol(\"A\", 3, 3)\n     B = MatrixSymbol(\"B\", 3, 3)\n     C = MatrixSymbol(\"C\", 3, 3)\n-\n     assert pretty(-A*B*C) == \"-A*B*C\"\n     assert pretty(A - B) == \"-B + A\"\n     assert pretty(A*B*C - A*B - B*C) == \"-A*B -B*C + A*B*C\"\n \n+    # issue #14814\n+    x = MatrixSymbol('x', n, n)\n+    y = MatrixSymbol('y*', n, n)\n+    assert pretty(x + y) == \"x + y*\"\n+    assert pretty(-a*x + -2*y*y) == \"-a*x -2*y**y*\"\n+\n \n def test_degree_printing():\n     expr1 = 90*degree\n",
        "repo": "sympy/sympy",
        "problem_statement": "Error pretty printing MatAdd\n```py\r\n>>> pprint(MatrixSymbol('x', n, n) + MatrixSymbol('y*', n, n))\r\nTraceback (most recent call last):\r\n  File \"./sympy/core/sympify.py\", line 368, in sympify\r\n    expr = parse_expr(a, local_dict=locals, transformations=transformations, evaluate=evaluate)\r\n  File \"./sympy/parsing/sympy_parser.py\", line 950, in parse_expr\r\n    return eval_expr(code, local_dict, global_dict)\r\n  File \"./sympy/parsing/sympy_parser.py\", line 863, in eval_expr\r\n    code, global_dict, local_dict)  # take local objects in preference\r\n  File \"<string>\", line 1\r\n    Symbol ('y' )*\r\n                 ^\r\nSyntaxError: unexpected EOF while parsing\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"./sympy/printing/pretty/pretty.py\", line 2371, in pretty_print\r\n    use_unicode_sqrt_char=use_unicode_sqrt_char))\r\n  File \"./sympy/printing/pretty/pretty.py\", line 2331, in pretty\r\n    return pp.doprint(expr)\r\n  File \"./sympy/printing/pretty/pretty.py\", line 62, in doprint\r\n    return self._print(expr).render(**self._settings)\r\n  File \"./sympy/printing/printer.py\", line 274, in _print\r\n    return getattr(self, printmethod)(expr, *args, **kwargs)\r\n  File \"./sympy/printing/pretty/pretty.py\", line 828, in _print_MatAdd\r\n    if S(item.args[0]).is_negative:\r\n  File \"./sympy/core/sympify.py\", line 370, in sympify\r\n    raise SympifyError('could not parse %r' % a, exc)\r\nsympy.core.sympify.SympifyError: Sympify of expression 'could not parse 'y*'' failed, because of exception being raised:\r\nSyntaxError: unexpected EOF while parsing (<string>, line 1)\r\n```\r\n\r\nThe code shouldn't be using sympify to handle string arguments from MatrixSymbol.\r\n\r\nI don't even understand what the code is doing. Why does it omit the `+` when the first argument is negative? This seems to assume that the arguments of MatAdd have a certain form, and that they will always print a certain way if they are negative. \n",
        "version": "1.1",
        "FAIL_TO_PASS": [
            "test_MatrixSymbol_printing"
        ],
        "PASS_TO_PASS": [
            "test_Adjoint",
            "test_Assignment",
            "test_AugmentedAssignment",
            "test_EulerGamma",
            "test_GoldenRatio",
            "test_GroebnerBasis",
            "test_Homomorphism",
            "test_MatrixElement_printing",
            "test_MatrixExpressions",
            "test_PrettyModules",
            "test_PrettyPoly",
            "test_ProductSet_paranthesis",
            "test_ProductSet_prod_char_issue_10413",
            "test_QuotientRing",
            "test_RandomDomain",
            "test_SingularityFunction",
            "test_Tr",
            "test_any_object_in_sequence",
            "test_beta",
            "test_categories",
            "test_complicated_symbol_unchanged",
            "test_degree_printing",
            "test_deltas",
            "test_diffgeom_print_WedgeProduct",
            "test_elliptic_functions",
            "test_expint",
            "test_function_subclass_different_name",
            "test_gammas",
            "test_hyper",
            "test_issue_10472",
            "test_issue_11801",
            "test_issue_12675",
            "test_issue_13651",
            "test_issue_4335",
            "test_issue_5524",
            "test_issue_6134",
            "test_issue_6285",
            "test_issue_6324",
            "test_issue_6359",
            "test_issue_6739",
            "test_issue_7117",
            "test_issue_7179",
            "test_issue_7180",
            "test_issue_7927",
            "test_issue_9877",
            "test_meijerg",
            "test_negative_fractions",
            "test_noncommutative",
            "test_pprint",
            "test_pretty_Add",
            "test_pretty_Boolean",
            "test_pretty_Complement",
            "test_pretty_ComplexRegion",
            "test_pretty_ComplexRootOf",
            "test_pretty_ConditionSet",
            "test_pretty_Contains",
            "test_pretty_Cycle",
            "test_pretty_Domain",
            "test_pretty_FormalPowerSeries",
            "test_pretty_FourierSeries",
            "test_pretty_ITE",
            "test_pretty_ImageSet",
            "test_pretty_Intersection_issue_10414",
            "test_pretty_KroneckerDelta",
            "test_pretty_Mod",
            "test_pretty_RootSum",
            "test_pretty_SetExpr",
            "test_pretty_Subs",
            "test_pretty_SymmetricDifference",
            "test_pretty_Trace_issue_9044",
            "test_pretty_UnevaluatedExpr",
            "test_pretty_Union_issue_10414",
            "test_pretty_ascii_str",
            "test_pretty_basic",
            "test_pretty_class",
            "test_pretty_derivatives",
            "test_pretty_dotproduct",
            "test_pretty_functions",
            "test_pretty_integrals",
            "test_pretty_lambda",
            "test_pretty_limits",
            "test_pretty_matrix",
            "test_pretty_ndim_arrays",
            "test_pretty_no_wrap_line",
            "test_pretty_order",
            "test_pretty_ordering",
            "test_pretty_piecewise",
            "test_pretty_prec",
            "test_pretty_primenu",
            "test_pretty_primeomega",
            "test_pretty_product",
            "test_pretty_rational",
            "test_pretty_relational",
            "test_pretty_seq",
            "test_pretty_sequences",
            "test_pretty_sets",
            "test_pretty_special_functions",
            "test_pretty_sqrt",
            "test_pretty_sqrt_char_knob",
            "test_pretty_sqrt_longsymbol_no_sqrt_char",
            "test_pretty_sum",
            "test_pretty_unicode_str",
            "test_print_builtin_set",
            "test_settings",
            "test_tensor_TensorProduct",
            "test_units",
            "test_upretty_greek",
            "test_upretty_modifiers",
            "test_upretty_multiindex",
            "test_upretty_sub_super",
            "test_upretty_subs_missing_in_24"
        ],
        "environment_setup_commit": "ec9e3c0436fbff934fa84e22bf07f1b3ef5bfac3",
        "patch": "diff --git a/sympy/printing/pretty/pretty.py b/sympy/printing/pretty/pretty.py\n--- a/sympy/printing/pretty/pretty.py\n+++ b/sympy/printing/pretty/pretty.py\n@@ -825,7 +825,8 @@ def _print_MatAdd(self, expr):\n             if s is None:\n                 s = pform     # First element\n             else:\n-                if S(item.args[0]).is_negative:\n+                coeff = item.as_coeff_mmul()[0]\n+                if _coeff_isneg(S(coeff)):\n                     s = prettyForm(*stringPict.next(s, ' '))\n                     pform = self._print(item)\n                 else:\n",
        "pr_link": "https://github.com/sympy/sympy/pull/14817"
    }
}