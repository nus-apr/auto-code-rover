{
    "task_id": "scikit-learn__scikit-learn-15535",
    "setup_info": {
        "repo_path": "/home/haifeng/projects/reverse-prompt/SWE-bench/testbed/scikit-learn__scikit-learn/setup_scikit-learn__scikit-learn__0.22",
        "env_name": "setup_scikit-learn__scikit-learn__0.22",
        "pre_install": [],
        "install": "python -m pip install -v --no-use-pep517 --no-build-isolation -e .",
        "test_cmd": "pytest --no-header -rA --tb=no -p no:cacheprovider sklearn/metrics/cluster/tests/test_common.py"
    },
    "task_info": {
        "instance_id": "scikit-learn__scikit-learn-15535",
        "base_commit": "70b0ddea992c01df1a41588fa9e2d130fb6b13f8",
        "hints_text": "broke in #10830 ping @glemaitre ",
        "created_at": "2019-11-05T02:09:55Z",
        "test_patch": "diff --git a/sklearn/metrics/cluster/tests/test_common.py b/sklearn/metrics/cluster/tests/test_common.py\n--- a/sklearn/metrics/cluster/tests/test_common.py\n+++ b/sklearn/metrics/cluster/tests/test_common.py\n@@ -161,7 +161,9 @@ def generate_formats(y):\n         y = np.array(y)\n         yield y, 'array of ints'\n         yield y.tolist(), 'list of ints'\n-        yield [str(x) for x in y.tolist()], 'list of strs'\n+        yield [str(x) + \"-a\" for x in y.tolist()], 'list of strs'\n+        yield (np.array([str(x) + \"-a\" for x in y.tolist()], dtype=object),\n+               'array of strs')\n         yield y - 1, 'including negative ints'\n         yield y + 1, 'strictly positive ints'\n \n",
        "repo": "scikit-learn/scikit-learn",
        "problem_statement": "regression in input validation of clustering metrics\n```python\r\nfrom sklearn.metrics.cluster import mutual_info_score\r\nimport numpy as np\r\n\r\nx = np.random.choice(['a', 'b'], size=20).astype(object)\r\nmutual_info_score(x, x)\r\n```\r\nValueError: could not convert string to float: 'b'\r\n\r\nwhile\r\n```python\r\nx = np.random.choice(['a', 'b'], size=20)\r\nmutual_info_score(x, x)\r\n```\r\nworks with a warning?\r\n\r\nthis worked in 0.21.1 without a warning (as I think it should)\r\n\r\n\r\nEdit by @ogrisel: I removed the `.astype(object)` in the second code snippet.\n",
        "version": "0.22",
        "FAIL_TO_PASS": [
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[adjusted_mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[adjusted_rand_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[completeness_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[fowlkes_mallows_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[homogeneity_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[normalized_mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[v_measure_score]"
        ],
        "PASS_TO_PASS": [
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[calinski_harabasz_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[davies_bouldin_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[silhouette_manhattan]",
            "sklearn/metrics/cluster/tests/test_common.py::test_format_invariance[silhouette_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[adjusted_mutual_info_score-adjusted_mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[adjusted_rand_score-adjusted_rand_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[calinski_harabasz_score-calinski_harabasz_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[completeness_score-completeness_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[davies_bouldin_score-davies_bouldin_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[fowlkes_mallows_score-fowlkes_mallows_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[homogeneity_score-homogeneity_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[mutual_info_score-mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[normalized_mutual_info_score-normalized_mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[silhouette_manhattan-metric_func9]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[silhouette_score-silhouette_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_inf_nan_input[v_measure_score-v_measure_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_non_symmetry[completeness_score-y11-y21]",
            "sklearn/metrics/cluster/tests/test_common.py::test_non_symmetry[homogeneity_score-y10-y20]",
            "sklearn/metrics/cluster/tests/test_common.py::test_normalized_output[adjusted_mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_normalized_output[adjusted_rand_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_normalized_output[completeness_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_normalized_output[fowlkes_mallows_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_normalized_output[homogeneity_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_normalized_output[normalized_mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_normalized_output[v_measure_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[adjusted_mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[adjusted_rand_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[calinski_harabasz_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[completeness_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[davies_bouldin_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[fowlkes_mallows_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[homogeneity_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[normalized_mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[silhouette_manhattan]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[silhouette_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_permute_labels[v_measure_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_single_sample[adjusted_mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_single_sample[adjusted_rand_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_single_sample[completeness_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_single_sample[fowlkes_mallows_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_single_sample[homogeneity_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_single_sample[mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_single_sample[normalized_mutual_info_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_single_sample[v_measure_score]",
            "sklearn/metrics/cluster/tests/test_common.py::test_symmetric_non_symmetric_union",
            "sklearn/metrics/cluster/tests/test_common.py::test_symmetry[adjusted_mutual_info_score-y13-y23]",
            "sklearn/metrics/cluster/tests/test_common.py::test_symmetry[adjusted_rand_score-y10-y20]",
            "sklearn/metrics/cluster/tests/test_common.py::test_symmetry[fowlkes_mallows_score-y15-y25]",
            "sklearn/metrics/cluster/tests/test_common.py::test_symmetry[mutual_info_score-y12-y22]",
            "sklearn/metrics/cluster/tests/test_common.py::test_symmetry[normalized_mutual_info_score-y14-y24]",
            "sklearn/metrics/cluster/tests/test_common.py::test_symmetry[v_measure_score-y11-y21]"
        ],
        "environment_setup_commit": "7e85a6d1f038bbb932b36f18d75df6be937ed00d",
        "patch": "diff --git a/sklearn/metrics/cluster/_supervised.py b/sklearn/metrics/cluster/_supervised.py\n--- a/sklearn/metrics/cluster/_supervised.py\n+++ b/sklearn/metrics/cluster/_supervised.py\n@@ -43,10 +43,10 @@ def check_clusterings(labels_true, labels_pred):\n         The predicted labels.\n     \"\"\"\n     labels_true = check_array(\n-        labels_true, ensure_2d=False, ensure_min_samples=0\n+        labels_true, ensure_2d=False, ensure_min_samples=0, dtype=None,\n     )\n     labels_pred = check_array(\n-        labels_pred, ensure_2d=False, ensure_min_samples=0\n+        labels_pred, ensure_2d=False, ensure_min_samples=0, dtype=None,\n     )\n \n     # input checks\n",
        "pr_link": "https://github.com/scikit-learn/scikit-learn/pull/15535"
    }
}