{
    "task_id": "django__django-12700",
    "setup_info": {
        "repo_path": "/media/media0/yuntong/SWE-bench/testbed/django__django/setup_django__django__3.1",
        "env_name": "setup_django__django__3.1",
        "pre_install": [],
        "install": "python -m pip install -e .",
        "test_cmd": "./tests/runtests.py --verbosity 2 view_tests.tests.test_debug"
    },
    "task_info": {
        "instance_id": "django__django-12700",
        "base_commit": "d51c50d836c5cf8db5566da17963f871be554615",
        "hints_text": "Do I need to change both versions? Or just create a single implementation for current master branch?",
        "created_at": "2020-04-11T01:58:27Z",
        "test_patch": "diff --git a/tests/view_tests/tests/test_debug.py b/tests/view_tests/tests/test_debug.py\n--- a/tests/view_tests/tests/test_debug.py\n+++ b/tests/view_tests/tests/test_debug.py\n@@ -1249,6 +1249,41 @@ def test_cleanse_setting_recurses_in_dictionary(self):\n             {'login': 'cooper', 'password': reporter_filter.cleansed_substitute},\n         )\n \n+    def test_cleanse_setting_recurses_in_list_tuples(self):\n+        reporter_filter = SafeExceptionReporterFilter()\n+        initial = [\n+            {\n+                'login': 'cooper',\n+                'password': 'secret',\n+                'apps': (\n+                    {'name': 'app1', 'api_key': 'a06b-c462cffae87a'},\n+                    {'name': 'app2', 'api_key': 'a9f4-f152e97ad808'},\n+                ),\n+                'tokens': ['98b37c57-ec62-4e39', '8690ef7d-8004-4916'],\n+            },\n+            {'SECRET_KEY': 'c4d77c62-6196-4f17-a06b-c462cffae87a'},\n+        ]\n+        cleansed = [\n+            {\n+                'login': 'cooper',\n+                'password': reporter_filter.cleansed_substitute,\n+                'apps': (\n+                    {'name': 'app1', 'api_key': reporter_filter.cleansed_substitute},\n+                    {'name': 'app2', 'api_key': reporter_filter.cleansed_substitute},\n+                ),\n+                'tokens': reporter_filter.cleansed_substitute,\n+            },\n+            {'SECRET_KEY': reporter_filter.cleansed_substitute},\n+        ]\n+        self.assertEqual(\n+            reporter_filter.cleanse_setting('SETTING_NAME', initial),\n+            cleansed,\n+        )\n+        self.assertEqual(\n+            reporter_filter.cleanse_setting('SETTING_NAME', tuple(initial)),\n+            tuple(cleansed),\n+        )\n+\n     def test_request_meta_filtering(self):\n         request = self.rf.get('/', HTTP_SECRET_HEADER='super_secret')\n         reporter_filter = SafeExceptionReporterFilter()\n",
        "repo": "django/django",
        "problem_statement": "Settings are cleaned insufficiently.\nDescription\n\t\nPosting publicly after checking with the rest of the security team.\nI just ran into a case where django.views.debug.SafeExceptionReporterFilter.get_safe_settings() would return several un-cleansed values. Looking at cleanse_setting() I realized that we \u200bonly take care of `dict`s but don't take other types of iterables into account but \u200breturn them as-is.\nExample:\nIn my settings.py I have this:\nMY_SETTING = {\n\t\"foo\": \"value\",\n\t\"secret\": \"value\",\n\t\"token\": \"value\",\n\t\"something\": [\n\t\t{\"foo\": \"value\"},\n\t\t{\"secret\": \"value\"},\n\t\t{\"token\": \"value\"},\n\t],\n\t\"else\": [\n\t\t[\n\t\t\t{\"foo\": \"value\"},\n\t\t\t{\"secret\": \"value\"},\n\t\t\t{\"token\": \"value\"},\n\t\t],\n\t\t[\n\t\t\t{\"foo\": \"value\"},\n\t\t\t{\"secret\": \"value\"},\n\t\t\t{\"token\": \"value\"},\n\t\t],\n\t]\n}\nOn Django 3.0 and below:\n>>> import pprint\n>>> from django.views.debug import get_safe_settings\n>>> pprint.pprint(get_safe_settings()[\"MY_SETTING\"])\n{'else': [[{'foo': 'value'}, {'secret': 'value'}, {'token': 'value'}],\n\t\t [{'foo': 'value'}, {'secret': 'value'}, {'token': 'value'}]],\n 'foo': 'value',\n 'secret': '********************',\n 'something': [{'foo': 'value'}, {'secret': 'value'}, {'token': 'value'}],\n 'token': '********************'}\nOn Django 3.1 and up:\n>>> from django.views.debug import SafeExceptionReporterFilter\n>>> import pprint\n>>> pprint.pprint(SafeExceptionReporterFilter().get_safe_settings()[\"MY_SETTING\"])\n{'else': [[{'foo': 'value'}, {'secret': 'value'}, {'token': 'value'}],\n\t\t [{'foo': 'value'}, {'secret': 'value'}, {'token': 'value'}]],\n 'foo': 'value',\n 'secret': '********************',\n 'something': [{'foo': 'value'}, {'secret': 'value'}, {'token': 'value'}],\n 'token': '********************'}\n",
        "version": "3.1",
        "FAIL_TO_PASS": [
            "test_cleanse_setting_recurses_in_list_tuples (view_tests.tests.test_debug.ExceptionReporterFilterTests)"
        ],
        "PASS_TO_PASS": [
            "A message can be provided in addition to a request",
            "A simple exception report can be generated",
            "An exception report can be generated even for a disallowed host.",
            "An exception report can be generated for just a request",
            "An exception report can be generated without request",
            "Large values should not create a large HTML.",
            "Non-UTF-8 exceptions/values should not make the output generation choke.",
            "Safe strings in local variables are escaped.",
            "Tests for not existing file",
            "The ExceptionReporter supports Unix, Windows and Macintosh EOL markers",
            "Unprintable values should not make the output generation choke.",
            "test_400 (view_tests.tests.test_debug.DebugViewTests)",
            "test_400 (view_tests.tests.test_debug.NonDjangoTemplatesDebugViewTests)",
            "test_403 (view_tests.tests.test_debug.DebugViewTests)",
            "test_403 (view_tests.tests.test_debug.NonDjangoTemplatesDebugViewTests)",
            "test_403_template (view_tests.tests.test_debug.DebugViewTests)",
            "test_404 (view_tests.tests.test_debug.DebugViewTests)",
            "test_404 (view_tests.tests.test_debug.NonDjangoTemplatesDebugViewTests)",
            "test_404_empty_path_not_in_urls (view_tests.tests.test_debug.DebugViewTests)",
            "test_404_not_in_urls (view_tests.tests.test_debug.DebugViewTests)",
            "test_callable_settings (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_callable_settings_forbidding_to_set_attributes (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_classbased_technical_404 (view_tests.tests.test_debug.DebugViewTests)",
            "test_cleanse_setting_basic (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_cleanse_setting_ignore_case (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_cleanse_setting_recurses_in_dictionary (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_cleansed_substitute_override (view_tests.tests.test_debug.CustomExceptionReporterFilterTests)",
            "test_custom_exception_reporter_filter (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_custom_exception_reporter_filter (view_tests.tests.test_debug.NonHTMLResponseExceptionReporterFilter)",
            "test_default_urlconf_template (view_tests.tests.test_debug.DebugViewTests)",
            "test_dict_setting_with_non_str_key (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_encoding_error (view_tests.tests.test_debug.ExceptionReporterTests)",
            "test_exception_fetching_user (view_tests.tests.test_debug.ExceptionReporterTests)",
            "test_exception_report_uses_meta_filtering (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_exception_reporter_from_request (view_tests.tests.test_debug.DebugViewTests)",
            "test_exception_reporter_from_settings (view_tests.tests.test_debug.DebugViewTests)",
            "test_files (view_tests.tests.test_debug.DebugViewTests)",
            "test_handle_db_exception (view_tests.tests.test_debug.DebugViewQueriesAllowedTests)",
            "test_hidden_settings_override (view_tests.tests.test_debug.CustomExceptionReporterFilterTests)",
            "test_ignore_traceback_evaluation_exceptions (view_tests.tests.test_debug.ExceptionReporterTests)",
            "test_message_only (view_tests.tests.test_debug.ExceptionReporterTests)",
            "test_message_only (view_tests.tests.test_debug.PlainTextReportTests)",
            "test_multivalue_dict_key_error (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_no_template_source_loaders (view_tests.tests.test_debug.DebugViewTests)",
            "test_non_html_response_encoding (view_tests.tests.test_debug.NonHTMLResponseExceptionReporterFilter)",
            "test_non_l10ned_numeric_ids (view_tests.tests.test_debug.DebugViewTests)",
            "test_non_sensitive_request (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_non_sensitive_request (view_tests.tests.test_debug.NonHTMLResponseExceptionReporterFilter)",
            "test_paranoid_request (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_paranoid_request (view_tests.tests.test_debug.NonHTMLResponseExceptionReporterFilter)",
            "test_regression_21530 (view_tests.tests.test_debug.DebugViewTests)",
            "test_reporting_frames_for_cyclic_reference (view_tests.tests.test_debug.ExceptionReporterTests)",
            "test_reporting_frames_source_not_match (view_tests.tests.test_debug.ExceptionReporterTests)",
            "test_reporting_frames_without_source (view_tests.tests.test_debug.ExceptionReporterTests)",
            "test_reporting_of_nested_exceptions (view_tests.tests.test_debug.ExceptionReporterTests)",
            "test_repr (view_tests.tests.test_debug.CallableSettingWrapperTests)",
            "test_request_meta_filtering (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_request_with_items_key (view_tests.tests.test_debug.ExceptionReporterTests)",
            "test_request_with_items_key (view_tests.tests.test_debug.PlainTextReportTests)",
            "test_sensitive_function_arguments (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_sensitive_function_keyword_arguments (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_sensitive_method (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_sensitive_post_parameters_not_called (view_tests.tests.test_debug.DecoratorsTests)",
            "test_sensitive_request (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_sensitive_request (view_tests.tests.test_debug.NonHTMLResponseExceptionReporterFilter)",
            "test_sensitive_settings (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_sensitive_variables_not_called (view_tests.tests.test_debug.DecoratorsTests)",
            "test_setting_allows_custom_subclass (view_tests.tests.test_debug.CustomExceptionReporterFilterTests)",
            "test_settings_with_sensitive_keys (view_tests.tests.test_debug.ExceptionReporterFilterTests)",
            "test_technical_404 (view_tests.tests.test_debug.DebugViewTests)",
            "test_technical_404_converter_raise_404 (view_tests.tests.test_debug.DebugViewTests)",
            "test_template_encoding (view_tests.tests.test_debug.DebugViewTests)",
            "test_template_encoding (view_tests.tests.test_debug.ExceptionReporterTests)",
            "test_template_exception (view_tests.tests.test_debug.PlainTextReportTests)",
            "test_template_exceptions (view_tests.tests.test_debug.DebugViewTests)",
            "test_template_not_found_error (view_tests.tests.test_debug.NonDjangoTemplatesDebugViewTests)",
            "test_unfrozen_importlib (view_tests.tests.test_debug.ExceptionReporterTests)"
        ],
        "environment_setup_commit": "0668164b4ac93a5be79f5b87fae83c657124d9ab",
        "patch": "diff --git a/django/views/debug.py b/django/views/debug.py\n--- a/django/views/debug.py\n+++ b/django/views/debug.py\n@@ -90,6 +90,10 @@ def cleanse_setting(self, key, value):\n                 cleansed = self.cleansed_substitute\n             elif isinstance(value, dict):\n                 cleansed = {k: self.cleanse_setting(k, v) for k, v in value.items()}\n+            elif isinstance(value, list):\n+                cleansed = [self.cleanse_setting('', v) for v in value]\n+            elif isinstance(value, tuple):\n+                cleansed = tuple([self.cleanse_setting('', v) for v in value])\n             else:\n                 cleansed = value\n         except TypeError:\n",
        "pr_link": "https://github.com/django/django/pull/12700"
    }
}